:root {
    --font-family: 'Inter', sans-serif;
    --transition-speed-fast: 0.3s;
    --transition-speed-med: 0.6s;
    --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
}

/* --- DEFINICIJE TEMA --- */
body.dark-theme {
    --bg-color: #0d1117; --primary-text: #e6edf3; --secondary-text: #7d8590;
    --accent-gradient: linear-gradient(45deg, #f72585, #7209b7);
    --card-bg: rgba(30, 36, 46, 0.7); --card-border: rgba(137, 147, 163, 0.2);
    --shadow: rgba(0,0,0,0.4); --primary-btn-bg: #238636;
    --game-board-bg: rgba(0,0,0,0.3); --game-board-frame: transparent;
    --grid-line-color: rgba(107, 114, 128, 0.3); --accent-highlight-color: #ffc9e5;
}
body.light-theme {
    --bg-color: #f0f2f5; --primary-text: #1c1e21; --secondary-text: #606770;
    --accent-gradient: linear-gradient(45deg, #007bff, #00aaff);
    --card-bg: rgba(255, 255, 255, 0.7); --card-border: rgba(0, 0, 0, 0.1);
    --shadow: rgba(0,0,0,0.1); --primary-btn-bg: #007bff;
    --game-board-bg: rgba(255,255,255,0.8); --game-board-frame: transparent;
    --grid-line-color: rgba(0, 0, 0, 0.15); --accent-highlight-color: #cce5ff;
}
body.neon-theme {
    --bg-color: #000000; --primary-text: #00ffde; --secondary-text: #8d8d8d;
    --accent-gradient: linear-gradient(45deg, #00ffde, #ff00ff);
    --card-bg: rgba(15, 15, 15, 0.7); --card-border: rgba(0, 255, 222, 0.3);
    --shadow: rgba(0, 255, 222, 0.2); --primary-btn-bg: #ff00ff;
    --game-board-bg: rgba(255,255,255,0.05);
    --game-board-frame: linear-gradient(160deg, #ff00ff, #00ffde, #ff00ff);
    --grid-line-color: rgba(0, 255, 222, 0.2); --accent-highlight-color: #d1fff8;
    text-shadow: 0 0 2px var(--secondary-text);
}
body.gold-theme {
    --bg-color: #1a160d; --primary-text: #f5e8c7; --secondary-text: #a89a7f;
    --accent-gradient: linear-gradient(45deg, #ffd700, #f0e68c, #daa520);
    --card-bg: rgba(40, 32, 20, 0.7); --card-border: rgba(255, 215, 0, 0.2);
    --shadow: rgba(0,0,0,0.5); --primary-btn-bg: #b8860b;
    --game-board-bg: rgba(0,0,0,0.2);
    --game-board-frame: linear-gradient(160deg, #b8860b, #ffd700, #b8860b);
    --grid-line-color: rgba(255, 215, 0, 0.2); --accent-highlight-color: #fff8e1;
}
body.silver-theme {
    --bg-color: #111827; --primary-text: #d1d5db; --secondary-text: #6b7280;
    --accent-gradient: linear-gradient(45deg, #9ca3af, #e5e7eb, #9ca3af);
    --card-bg: rgba(31, 41, 55, 0.7); --card-border: rgba(156, 163, 175, 0.2);
    --shadow: rgba(0,0,0,0.5); --primary-btn-bg: #4b5563;
    --game-board-bg: rgba(0,0,0,0.3); --game-board-frame: transparent;
    --grid-line-color: rgba(107, 114, 128, 0.3); --accent-highlight-color: #f9fafb;
}
.neon-theme h1, .neon-theme h2, .gold-theme h1, .gold-theme h2 { text-shadow: 0 0 8px var(--shadow); }

/* --- OSNOVNI STILOVI TELA I POZADINE --- */
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
html { height: -webkit-fill-available; }
body { font-family: var(--font-family); background: var(--bg-color); color: var(--primary-text); margin: 0; overflow: hidden; height: 100vh; height: -webkit-fill-available; width: 100vw; transition: background-color 0.5s, color 0.5s; }
@keyframes aurora-move { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
.aurora-background { position: fixed; top: 50%; left: 50%; width: 150vmax; height: 150vmax; animation: aurora-move 40s infinite linear; z-index: -1; }
.aurora-dot { position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.6; }
.aurora-dot:nth-child(1) { width: 600px; height: 600px; top: 0; left: 10%; background: #f72585; } .aurora-dot:nth-child(2) { width: 500px; height: 500px; top: 20%; left: 60%; background: #7209b7; } .aurora-dot:nth-child(3) { width: 400px; height: 400px; top: 70%; left: 20%; background: #4361ee; }

/* --- EKRANI I TRANZICIJE --- */
.screen { position: absolute; width: 100%; height: 100%; display: flex; flex-direction: column; padding: 1rem; opacity: 0; visibility: hidden; pointer-events: none; transform: scale(0.95); transition: opacity var(--transition-speed-med) var(--ease-out-expo), transform var(--transition-speed-med) var(--ease-out-expo); }
.screen.active { opacity: 1; visibility: visible; pointer-events: auto; transform: scale(1); }
.screen h2 { font-size: 2rem; font-weight: 900; text-align: center; margin: 1rem 0 2rem 0; }

/* --- GLAVNI MENI - NOVI 3D EFEKAT --- */
#main-menu-screen { align-items: center; justify-content: center; text-align: center; perspective: 1500px; }
.main-header h1 { font-size: clamp(3rem, 15vw, 6rem); font-weight: 900; line-height: 1; letter-spacing: -0.05em; background: var(--accent-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 2rem; transform: translateZ(60px); }
.menu-container { transform-style: preserve-3d; }
.menu-item { border: 1px solid var(--card-border); border-radius: 1rem; padding: 1px; margin: 1rem auto; width: 90%; max-width: 400px; backdrop-filter: blur(20px); background: transparent; cursor: pointer; position: relative; transition: transform 0.1s linear, box-shadow 0.4s var(--ease-out-expo); transform: rotateY(var(--rotate-y, 0deg)) rotateX(var(--rotate-x, 0deg)); }
.menu-item-content { background: var(--card-bg); border-radius: inherit; padding: 1.5rem; }
.menu-item::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; border-radius: 1rem; border: 2px solid transparent; background: var(--accent-gradient) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: destination-out; mask-composite: exclude; opacity: 0; transition: opacity 0.4s var(--ease-out-expo); }
.menu-item:hover::before { opacity: 1; }
.menu-item h2 { margin: 0; font-weight: 700; font-size: 1.5rem;}
.highscore { font-size: 0.8rem; color: var(--secondary-text); margin-top: 0.5rem; font-weight: 700; }
.footer-menu { position: absolute; bottom: 2rem; display: flex; gap: 1rem; transform: translateZ(40px); }

/* --- EKRAN ZA IZBOR MODA --- */
#game-mode-screen { align-items: center; justify-content: center; gap: 1.5rem; }
.mode-btn { background: var(--card-bg); border: 1px solid var(--card-border); padding: 1.25rem; border-radius: 1rem; cursor: pointer; transition: transform 0.2s; text-align: left;}
.mode-btn:hover { transform: scale(1.05); border-color: var(--primary-text); }
.difficulty-selector { display: flex; background: var(--card-bg); border-radius: 0.75rem; padding: 5px; }
.difficulty-btn { background: transparent; border: none; color: var(--secondary-text); padding: 0.75rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: all 0.3s; }
.difficulty-btn.active { background: var(--primary-btn-bg); color: white; }

/* --- EKRAN STATISTIKE --- */
#stats-screen { align-items: center; justify-content: flex-start; gap: 1rem; }
.stats-container { width: 100%; max-width: 500px; padding: 1rem; }

/* --- EKRAN SA IGROM --- */
#game-screen { justify-content: flex-start; padding: 0; }
.game-header-bar { display: none; width: 100%; justify-content: space-between; align-items: center; padding: 1rem; flex-shrink: 0; position: relative; z-index: 10; }
.game-content-wrapper { flex-grow: 1; width: 100%; display: flex; justify-content: center; align-items: center; padding-bottom: 1rem; }
.game-area { display: none; width: 100%; justify-content: center; align-items: center; gap: 1rem; } .game-area.active { display: flex; }

.icon-btn { background: var(--card-bg); border: 1px solid var(--card-border); color: var(--primary-text); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; user-select: none; }
.icon-btn:active { transform: scale(0.9); }
.icon-btn.large { width: 56px; height: 56px; font-size: 1.8rem; }
.icon-btn.small { width: 40px; height: 40px; font-size: 1.4rem; }
.back-to-main-menu { position: absolute; top: 1rem; left: 1rem; z-index: 10; }

/* --- UI PRIKAZ U ZAVISNOSTI OD IGRE --- */
body.tetris-active #tetris-ui-header.tetris-only { display: flex; }
body.puzzle-active .puzzle-only { display: flex; }

/* --- TETRIS NOVI UI --- */
#tetris-ui-header { width: 100%; padding: 1rem; justify-content: center; align-items: stretch; gap: 1rem; flex-shrink: 0;}
.ui-frame { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 1rem; padding: 0.75rem; text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
.score-frame { flex: 1.5; } .frame-title { font-size: 0.7rem; color: var(--secondary-text); font-weight: 700; margin-bottom: 0.5rem; text-transform: uppercase; }
.score-display, .level-display { font-size: 2rem; font-weight: 900; line-height: 1; }
.best-score-container { margin-top: 0.5rem; color: var(--secondary-text); } .crown { font-size: 1rem; display: block; } .best-score-display { font-weight: 700; color: var(--primary-text); }
#tetris-next-piece { flex-grow: 1; display: flex; justify-content: center; align-items: center; } .game-controls { display: flex; justify-content: space-around; margin-top: 0.5rem; }

/* --- PUZZLE UI --- */
.puzzle-only.game-header-bar { display: flex; }
.game-info-container { text-align: center; } .game-score { font-size: 1.5rem; font-weight: 700; transition: transform 0.2s; } .game-timer { font-size: 1rem; color: var(--secondary-text); min-height: 1.2rem; }
#puzzle-pieces-container-wrapper.puzzle-only { display: flex; }

/* --- IGRE I TABLE - VIDLJIVA MREŽA --- */
.game-board-frame { padding: 0; border: none; background: var(--game-board-frame); background-size: 300% 300%; animation: frame-flow 5s linear infinite; }
@keyframes frame-flow { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
#tetris-board, #puzzle-board { background-color: var(--game-board-bg); }
#tetris-board { display: grid; grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(20, 1fr); width: min(70vw, 300px); height: min(140vw, 600px); }
#puzzle-board { display: grid; grid-template-columns: repeat(10, 1fr); grid-template-rows: repeat(10, 1fr); width: 90vw; height: 90vw; max-width: 400px; max-height: 400px; }
#tetris-game-area { flex-direction: column; align-items: center; }
.tetris-cell, .puzzle-cell { box-shadow: inset 0 0 0 1px var(--grid-line-color); background-color: transparent; position: relative; }

/* --- BLOKOVI - NOVI DIZAJN --- */
.game-block { border-radius: min(25%, 6px); background-color: var(--color); background-image: linear-gradient(160deg, rgba(255,255,255,0.3), rgba(255,255,255,0) 50%); box-shadow: inset 0px 2px 1px rgba(255,255,255,0.4), inset 0px -2px 1px rgba(0,0,0,0.3), 0 5px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.2); }
.puzzle-piece { display: grid; touch-action: none; cursor: grab; transition: transform 0.2s; } .puzzle-piece:active { transform: scale(1.1); }
.puzzle-piece-cell { width: 25px; height: 25px; }
.puzzle-piece.dragging { position: absolute; z-index: 1000; pointer-events: none; opacity: 0.9; transform: scale(1.2) !important; }
.tetris-cell.ghost { background-color: rgba(255, 255, 255, 0.1); border-radius: 4px; }
.puzzle-cell.ghost-path { background-color: var(--color) !important; opacity: 0.4; border-radius: 4px;}
.bomb-timer { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.2rem; font-weight: 900; color: white; text-shadow: 0 0 5px black; animation: bomb-pulse 1s infinite; }
@keyframes bomb-pulse { 50% { transform: translate(-50%,-50%) scale(1.2); color: red; } }

/* --- ANIMACIJE --- */
#countdown-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; font-size: 25vw; font-weight: 900; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
#countdown-overlay.active { opacity: 1; visibility: visible; }
@keyframes countdown-pop { 0%{transform:scale(0.5);opacity:0;} 50%{transform:scale(1.2);opacity:1;} 100%{transform:scale(1);opacity:1;} }
#countdown-text { animation: countdown-pop 1s infinite; animation-timing-function: var(--ease-out-expo); }
@keyframes line-clear-flash { 0%, 100% {transform: scale(1);} 50% {transform: scale(1.05); background-color: var(--accent-highlight-color); box-shadow: 0 0 20px var(--accent-highlight-color);}}
.line-clearing { animation: line-clear-flash 0.4s forwards; background-color: var(--accent-highlight-color) !important; }
@keyframes screen-shake { 0%,100%{transform:translateX(0);} 25%{transform:translateX(-4px);} 50%{transform:translateX(4px);} 75%{transform:translateX(-4px);} }
.screen-shake { animation: screen-shake 0.15s 1; }
@keyframes score-pop { 50% { transform: scale(1.25); } }
.score-updated { animation: score-pop 0.3s var(--ease-out-expo); }

#pause-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 900; opacity: 0; visibility: hidden; transition: all 0.3s; }
#pause-overlay.active { opacity: 1; visibility: visible; } .pause-box { text-align: center; }

/* --- MODALI I POMOĆ --- */
#first-time-help-overlay { position: absolute; top:0; left:0; width:100%; height:100%; z-index: 1001; background:rgba(0,0,0,0.8); opacity:0; visibility:hidden; transition: all 0.5s; pointer-events: none; }
#first-time-help-overlay.active { opacity: 1; visibility: visible; pointer-events: auto; }
.help-bubble { position: absolute; background: var(--primary-text); color: var(--bg-color); padding: 1rem; border-radius: 0.5rem; max-width: 150px; text-align: center; font-weight: 700; box-shadow: 0 5px 15px var(--shadow);}
#dismiss-help-btn { position: absolute; bottom: 3rem; left: 50%; transform: translateX(-50%); }
