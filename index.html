<!DOCTYPE html>
<html lang="sr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Block • 8×8 — Lux Minimal</title>
  <style>
    :root{
      --bg:#0b0f16; --text:#e8ecf1; --muted:#a6afc3; --panel:#0f1420; --grid:#1b2433;
      --accent:#2ec5ff; --good:#57c857; --bad:#e06b6b; --stroke:#223046;
    }
    .light{
      --bg:#f6f8fb; --text:#0e1014; --muted:#4c5672; --panel:#ffffff; --grid:#e6ebf4;
      --accent:#3a6cff; --good:#27a227; --bad:#d34b4b; --stroke:#cfd7e6;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      overflow:hidden;
    }
    button{ font:inherit; cursor:pointer; border:0; background:transparent; color:inherit; }
    button:focus{ outline:none; }
    *{ -webkit-tap-highlight-color:transparent; }

    /* GLOBAL BG CANVAS (iza svega) */
    #bg{
      position:fixed; inset:0; width:100vw; height:100vh; display:block;
      z-index:0; pointer-events:none;
    }

    /* START SCREEN */
    #startScreen{ position:relative; width:100%; height:100vh; overflow:hidden; z-index:1; }
    .ss-inner{
      position:relative; z-index:2; display:flex; flex-direction:column; align-items:center; justify-content:center;
      height:100%; gap:16px; padding:24px; text-align:center;
    }
    .ss-inner h1{ margin:0; font-size:28px; letter-spacing:1px; text-shadow:0 6px 30px rgba(0,0,0,.35); }
    .sub{ max-width:560px; opacity:.75; font-size:14px; }
    .cta{ display:flex; gap:12px; margin-top:8px; flex-wrap:wrap; justify-content:center; }

    /* Dugme animacije */
    .primary, .secondary{
        transition: transform .2s cubic-bezier(.175,.885,.32,1.275), box-shadow .2s ease-in-out;
    }
    .primary{
      background:linear-gradient(180deg,#0d111a,#0c121e);
      border:1px solid rgba(255,255,255,.08);
      color:#ffd87a; padding:12px 18px; border-radius:14px; font-weight:700;
      box-shadow:0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.06);
    }
    .secondary{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08);
      padding:12px 18px; border-radius:14px; font-weight:700;
      box-shadow:0 6px 20px rgba(0,0,0,.2);
    }
    .primary:hover{ transform: translateY(-2px) scale(1.02); box-shadow:0 12px 36px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.08); }
    .secondary:hover{ transform: translateY(-2px) scale(1.02); box-shadow:0 8px 25px rgba(0,0,0,.25); }
    .primary:active, .secondary:active{ transform: translateY(0) scale(0.98); box-shadow:0 2px 10px rgba(0,0,0,.2); }

    /* gornje ikonice (desni gornji ugao) */
    .top-icons{
      position:fixed; right:12px; top:12px; z-index:3; display:flex; flex-direction:column; gap:8px;
      align-items:flex-end;
    }
    .icon-btn{
      width:42px; height:42px; display:grid; place-items:center;
      background:rgba(12,18,30,.55); border:1px solid rgba(255,255,255,.08);
      border-radius:12px; font-size:20px; box-shadow:0 10px 25px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .icon-btn:hover{ transform: translateY(-1px); box-shadow:0 12px 30px rgba(0,0,0,.45); }
    .icon-btn:active{ transform:translateY(1px); }

    /* APP (igra) */
    .wrap{ display:none; flex-direction:column; height:100vh; max-width:720px; margin:0 auto; position:relative; z-index:1; }
    header{ padding:10px 14px; display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .brand{ font-weight:800; letter-spacing:.4px; opacity:.9 }
    .hud{ display:flex; gap:10px; align-items:center; }
    .pill{ background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:12px; font-weight:700; }
    #levelPill{ display:none; }

    .toolbar{ display:flex; gap:8px; align-items:center; }
    .btn{
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
      color:var(--text); padding:8px 12px; border-radius:12px; font-weight:700;
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.2); }
    .btn:active{ transform: translateY(0); box-shadow:0 1px 6px rgba(0,0,0,.15); }

    .board-area{ flex:1; display:flex; align-items:center; justify-content:center; padding:6px 16px; position:relative; flex-direction:column; }
    
    /* Podesavanje grida da bude malo više */
    #game-container-wrapper {
      display: flex;
      align-items: flex-start; /* Poravnanje gore */
      justify-content: center;
      height: 100%;
      width: 100%;
      padding-top: 15vh; /* Podesi visinu po želji */
    }
    
    canvas{ touch-action:none; }
    
    /* Novi glow efekat na kanvasu */
    #game-container {
        position: relative;
        box-shadow: 0 0 0 0px var(--accent);
        transition: box-shadow .3s ease-in-out;
        border-radius: 16px;
    }
    #game-container.glow {
        animation: glow-pulse 1.8s infinite ease-in-out;
    }
    @keyframes glow-pulse {
        0%, 100% { box-shadow: 0 0 10px 0px color-mix(in oklab, var(--accent) 50%, transparent); }
        50% { box-shadow: 0 0 20px 8px color-mix(in oklab, var(--accent) 80%, transparent); }
    }


    /* Prilagođeni tray da bude bliže gridu i bez okvira */
    .tray{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; padding:10px 16px 14px; margin-top: -60px; /* Dodatno pomeranje gore */ }
    .slot{
      background:transparent;
      border:none;
      min-height:96px; display:flex; align-items:center; justify-content:center; transition:.18s; position:relative;
      backdrop-filter: blur(6px);
    }
    .slot.used{ opacity:.35 } .slot.good{ border-color:var(--good); box-shadow:0 0 0 2px color-mix(in oklab, var(--good) 35%, transparent); }
    .slot.bad{ border-color:var(--bad); box-shadow:0 0 0 2px color-mix(in oklab, var(--bad) 35%, transparent); }

    .footer{ text-align:center; opacity:.55; font-size:12px; padding-bottom:10px }

    /* Overlays (modali) */
    .overlay{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:20; }
    .overlay .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.55); backdrop-filter: blur(4px); }
    .overlay .panel{
      position:relative; z-index:2; background:rgba(12,18,30,.85); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:16px; width:min(720px, calc(100% - 24px)); color:var(--text);
      box-shadow:0 30px 80px rgba(0,0,0,.45); max-height:86vh; overflow:hidden;
      opacity:0; transform: translateY(20px); transition: opacity .3s ease, transform .3s ease;
    }
    .overlay.open .panel{
      opacity:1; transform: translateY(0);
    }
    .overlay h3, .overlay h2{ margin:0 0 10px 0; }

    /* Settings */
    #settingsModal .row{ display:flex; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px solid rgba(255,255,255,.06); }
    #settingsModal .row:last-child{ border-bottom:0; }

    /* Achievements */
    .ach-top{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:10px; }
    .ach-pager{ display:flex; gap:8px; align-items:center; }
    .ach-grid{ display:grid; grid-template-columns:1fr; gap:8px; max-height:52vh; overflow:auto; padding-right:4px; }
    .ach-card{
      background:rgba(15,20,32,.75); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:10px;
    }
    .ach-card.done{ opacity:.6; }
    .ach-card h4{ margin:0 0 6px 0; font-size:14px; }
    .ach-card .meta{ display:flex; gap:10px; align-items:center; font-size:12px; opacity:.8; }
    .ach-card .badge{ background:rgba(255,255,255,.08); padding:3px 8px; border-radius:999px; }
    .ach-card .progress{ height:6px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; margin-top:6px; }
    .ach-card .progress i{ display:block; height:100%; background:linear-gradient(90deg, var(--accent), #7fe0ff); }

    .ms-box{ margin-top:12px; padding:10px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(15,20,32,.75); }
    .ms-bar{ height:8px; border-radius:999px; background:rgba(255,255,255,.08); overflow:hidden; }
    .ms-bar i{ display:block; height:100%; width:0%; background:linear-gradient(90deg, var(--accent), #7fe0ff); }
    .ms-actions{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px; }
    .ms-actions .btn[aria-disabled="true"]{ opacity:.4; pointer-events:none; }

    /* Kolekcija (TABOVI) */
    .tabs{ display:flex; gap:8px; margin-bottom:10px; }
    .tab-btn{
      padding:8px 12px; border-radius:10px; border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06); font-weight:700;
    }
    .tab-btn[aria-selected="true"]{
      background:linear-gradient(180deg,#0d111a,#0c121e); color:#ffd87a; border-color:rgba(255,255,255,.14);
    }
    .tab-panel{ display:none; }
    .tab-panel[aria-hidden="false"]{ display:block; }

    .collection-grid{
      display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr));
      gap:10px; max-height:58vh; overflow:auto; padding-right:4px;
    }
    .col-card{
      position:relative; background:rgba(15,20,32,.75); border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:10px; display:flex; flex-direction:column; gap:6px; min-height:110px;
    }
    .col-card.locked{ opacity:.55; }
    .col-card .badge{ align-self:flex-start; background:rgba(255,255,255,.08); padding:3px 8px; border-radius:999px; font-size:12px; }
    .col-card .apply{ align-self:flex-end; padding:6px 10px; border-radius:10px; border:1px solid rgba(255,255,255,.10); background:rgba(255,255,255,.06); }
    .activeTag{ position:absolute; top:8px; right:10px; font-size:11px; background:#1f8b4c; border:1px solid #2bb36a; padding:2px 6px; border-radius:999px; }
  </style>
</head>
<body>

  <canvas id="bg"></canvas>

  <div id="startScreen">
    <div class="top-icons">
      <button id="settingsBtn" class="icon-btn" title="Podešavanja">⚙️</button>
      <button id="achBtn" class="icon-btn" title="Dostignuća">🏆</button>
      <button id="collectionBtn" class="icon-btn" title="Kolekcija">🎨</button>
    </div>

    <div class="ss-inner">
      <h1>BLOCK • 8×8</h1>
      <div class="sub">Pomeraj blokove, popuni red/kolonu i skupljaj poene. Čisto, brzo i luks izgled.</div>
      <div class="cta">
        <button id="startClassic" class="primary">▶ Classic</button>
        <button id="startObstacles" class="secondary">🧱 Obstacles</button>
      </div>
    </div>
  </div>

  <div class="wrap" id="app">
    <header>
      <div class="brand"></div>
      <div class="hud">
        <div class="pill">Score: <span id="score">0</span></div>
        <div id="levelPill" class="pill">Lvl: <span id="lvl">1</span></div>
        <div class="pill">Best: <span id="best">0</span></div>
      </div>
      <div class="toolbar">
        <button id="backBtn" class="btn" title="Nazad">🏠</button>
        <button id="reset" class="btn" title="Nova igra">Reset</button>
      </div>
    </header>

    <div class="board-area">
      <div id="game-container-wrapper">
        <div id="game-container">
          <canvas id="game" width="360" height="360" aria-label="8x8 tabla"></canvas>
          <canvas id="fx" width="360" height="360" style="position:absolute; inset:0; pointer-events:none"></canvas>
        </div>
      </div>
    </div>

    <div class="tray" id="tray"></div>
    <div class="footer">Lux aurora pozadina • zaobljen grid • metal/glass/gem skinovi</div>
  </div>

  <div id="settingsModal" class="overlay">
    <div class="backdrop"></div>
    <div class="panel">
      <h3>Podešavanja</h3>
      <div class="row"><span>Tema</span><button id="setTheme" class="btn">Prebaci temu</button></div>
      <div class="row"><span>Zvuk</span><button id="setSound" class="btn">🔈 On</button></div>
      <div class="row"><span>Resetuj Best</span><button id="resetBest" class="btn">Obriši</button></div>
      <div class="row"><span>Test</span><button id="runTests" class="btn">Run</button></div>
      <div style="text-align:right; margin-top:8px"><button id="closeSettings" class="btn">Zatvori</button></div>
    </div>
  </div>

  <div id="achievementsModal" class="overlay">
    <div class="backdrop"></div>
    <div class="panel">
      <div class="ach-top">
        <h3>🏆 Dostignuća</h3>
        <div class="ach-pager">
          <button id="achPrev" class="btn">◀</button>
          <div>Strana: <span id="achPageLbl">1</span>/20</div>
          <button id="achNext" class="btn">▶</button>
        </div>
      </div>

      <div id="achView">
        <div id="achList" class="ach-grid"></div>

        <div class="ms-box">
          <div style="margin-bottom:6px">
            <strong id="msTitle">Milestone</strong>
            <div id="msDesc" class="sub" style="margin-top:4px; opacity:.8"></div>
          </div>
          <div class="ms-bar"><i id="msBar" style="width:0%"></i></div>
          <div id="msCounters" style="margin-top:6px; font-size:13px; opacity:.85"></div>
          <div id="msBlockProg" style="margin-top:2px; font-size:13px; opacity:.85"></div>
          <div class="ms-actions">
            <button id="btnWatchAd" class="btn">🎬 Gledaj</button>
            <button id="btnClaim" class="btn" aria-disabled="true">🎁 Preuzmi</button>
          </div>
        </div>
      </div>

      <div style="text-align:right; margin-top:10px">
        <button id="closeAch" class="btn">Zatvori</button>
      </div>
    </div>
  </div>

  <div id="collectionModal" class="overlay">
    <div class="backdrop"></div>
    <div class="panel">
      <h3>🎨 Kolekcija</h3>

      <div class="tabs">
        <button id="tabThemes" class="tab-btn" aria-selected="true">Teme</button>
        <button id="tabSkins" class="tab-btn" aria-selected="false">Skinovi</button>
      </div>

      <div id="panelThemes" class="tab-panel" aria-hidden="false">
        <div id="themesGrid" class="collection-grid"></div>
      </div>

      <div id="panelSkins" class="tab-panel" aria-hidden="true">
        <div id="skinsGrid" class="collection-grid"></div>
      </div>

      <div style="text-align:right; margin-top:10px">
        <button id="closeCollection" class="btn">Zatvori</button>
      </div>
    </div>
  </div>

  <div id="gameOver" class="overlay">
    <div class="backdrop"></div>
    <div class="panel">
      <h2>Kraj igre</h2>
      <div id="goStats" style="margin:6px 0 12px 0">Score: 0 • Best: 0</div>
      <div style="display:flex; gap:8px; justify-content:center">
        <button id="playAgain" class="btn">Igraj ponovo</button>
        <button id="goMenu" class="btn">Meni</button>
      </div>
    </div>
  </div>

  <canvas id="dragLayer" style="position:fixed; inset:0; width:100vw; height:100vh; z-index:30; pointer-events:none;"></canvas>

  <script src="script.js"></script>
</body>
</html>
